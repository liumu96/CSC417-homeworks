#include <d2V_spring_particle_particle_dq2.h>

// Compute the per-spring hessian of the spring potential energy.
void d2V_spring_particle_particle_dq2(Eigen::Ref<Eigen::Matrix66d> H, Eigen::Ref<const Eigen::Vector3d> q0, Eigen::Ref<const Eigen::Vector3d> q1, double l0, double stiffness)
{
    double q0x = q0(0);
    double q0y = q0(1);
    double q0z = q0(2);
    double q1x = q1(0);
    double q1y = q1(1);
    double q1z = q1(2);
    H(0, 0) = pow(q0x * 2.0 - q1x * 2.0, 2.0) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) - (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (pow(q0x * 2.0 - q1x * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(0, 1) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(0, 2) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(0, 3) = (pow(q0x * 2.0 - q1x * 2.0, 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - (pow(q0x * 2.0 - q1x * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(0, 4) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(0, 5) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(1, 0) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(1, 1) = pow(q0y * 2.0 - q1y * 2.0, 2.0) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) - (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (pow(q0y * 2.0 - q1y * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(1, 2) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(1, 3) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(1, 4) = (pow(q0y * 2.0 - q1y * 2.0, 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - (pow(q0y * 2.0 - q1y * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(1, 5) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(2, 0) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(2, 1) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(2, 2) = pow(q0z * 2.0 - q1z * 2.0, 2.0) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) - (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (pow(q0z * 2.0 - q1z * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(2, 3) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(2, 4) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(2, 5) = (pow(q0z * 2.0 - q1z * 2.0, 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - (pow(q0z * 2.0 - q1z * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(3, 0) = (pow(q0x * 2.0 - q1x * 2.0, 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - (pow(q0x * 2.0 - q1x * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(3, 1) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(3, 2) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(3, 3) = pow(q0x * 2.0 - q1x * 2.0, 2.0) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) - (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (pow(q0x * 2.0 - q1x * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(3, 4) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(3, 5) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(4, 0) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(4, 1) = (pow(q0y * 2.0 - q1y * 2.0, 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - (pow(q0y * 2.0 - q1y * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(4, 2) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(4, 3) = ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0y * 2.0 - q1y * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(4, 4) = pow(q0y * 2.0 - q1y * 2.0, 2.0) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) - (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (pow(q0y * 2.0 - q1y * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(4, 5) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(5, 0) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(5, 1) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(5, 2) = (pow(q0z * 2.0 - q1z * 2.0, 2.0) * (-1.0 / 4.0)) / (q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) - (pow(q0z * 2.0 - q1z * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(5, 3) = ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0x * 2.0 - q1x * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(5, 4) = ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0)) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) + ((q0y * 2.0 - q1y * 2.0) * (q0z * 2.0 - q1z * 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H(5, 5) = pow(q0z * 2.0 - q1z * 2.0, 2.0) / (q0x * (q0x - q1x) * 4.0 + q0y * (q0y - q1y) * 4.0 - q1x * (q0x - q1x) * 4.0 + q0z * (q0z - q1z) * 4.0 - q1y * (q0y - q1y) * 4.0 - q1z * (q0z - q1z) * 4.0) - (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z)) + (pow(q0z * 2.0 - q1z * 2.0, 2.0) * (l0 - sqrt(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z))) * 1.0 / pow(q0x * (q0x - q1x) + q0y * (q0y - q1y) - q1x * (q0x - q1x) + q0z * (q0z - q1z) - q1y * (q0y - q1y) - q1z * (q0z - q1z), 3.0 / 2.0)) / 4.0;
    H *= stiffness;
}